#!/usr/bin/env zsh
# ====================[ zeshy                              ]====================
#                     [ Time-stamp: "2008-10-27 03:30:32 leycec" ]
#
# --------------------( SYNOPSIS                           )--------------------
# Shebang Zeshy loader. This Zeshy-specific Zsh shell script replaces the
# "#!/usr/bin/env zsh" shebang command, which invokes Zsh on the file, with a
# "#!/usr/bin/env zeshy" shebang command, which invokes Zeshy-capable Zsh on the
# same file.
#
# Here, "Zeshy-capable Zsh" means a Zsh shell process having available:
#
# * All functions, aliases, and variables exported by Zeshy Core. 
# * No functions or aliases exported by other Zeshy components.
# * But possibly variables exported by other Zeshy components, if inherited from the
#   caller's environment. In other words, do not rely on this.
#
# --------------------( USAGE                              )--------------------
# Third-party scripts requiring one or more Zeshy components are encouraged to
# replace any existing shebang line at the top of each such file with:
#
#     #!/usr/bin/env zeshy
# 
# This invokes this script on each such file, which:
#
# * Sources "zeshy/core", the core Zeshy module providing (among other base
#   functionality) the import() function with which third-party scripts may
#   optionally import all other Zeshy modules in a platform portable manner.
# * Runs "zsh" on the passed file.
#
# Third-party scripts requiring one or more Zeshy components but not declaring
# the above shebang line *must* manually source "zeshy/core" at the top of each
# such file with:
#
#     #!/usr/bin/env zsh
#     
# Note that this script performs additional checks for path and platform sanity;
# thus, the above approach is strongly discouraged.

# ....................{ MAIN                               }....................
# Ensure "${ZESHY_HOME}" is defined and, if not, try doing so.
if [[ -z "${ZESHY_HOME}" ]]; then
    if [[ -r    '/etc/env.d/50zeshy' ]]
    then source '/etc/env.d/50zeshy'
    else export ZESHY_HOME='/usr/share/zeshy'
    fi
fi

# If Zeshy does not exist, fail with error.
if [[ ! -d "${ZESHY_HOME}" ]]; then
    print "zeshy: \"${ZESHY_HOME}\" not found" 2>&1
    exit 1
fi

# Import Zeshy Core.
source "${ZESHY_HOME}/src/zeshy/core"

# If the caller requested an additional Zeshy component be imported and run, do
# so. This is always the case when this script is indirectly invoked via a
# shebang header (e.g., via the first line of a Zeshy script beginning with
# "#!/usr/bin/env zeshy"), but otherwise not necessarily the case.
is_at_least_one_argument && zimport "${@}"

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyright 2007-2012 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
