#!/usr/bin/env zsh

declare_parcel_as_script_with_stdin <<'-/-'
Configure default `zeshy` *color styles* (i.e., mappings from style to color
names, permitting human-readable customization of colors output by `zeshy`
runnables). Such styles are only defaults and hence only output if the current
user's configured theme fails to define such styles.
-/-

# ....................{ COLORS                             }....................
declare_global_with_stdin <<'/---'
map ZESHY_STYLE_TO_COLOR_NAMES

Map non-prompt style to color names, permitting human-readable customization of
colors output by all `zeshy` runnables _except_ those relating to the prompt.
See ${ZESHY_STYLE_TO_COLOR_NAMES_PROMPT} for further details on prompt styles.

== Styles ==

Styles are `.`-delimited identifiers specific to the runnables referencing such
styles (e.g., `output_call_stack.line`, the line style specific to function
output_call_stack()). To preserve uniqueness, such identifiers are typically
prefixed by the dot-suffixed name of the corresponding runnables.

== Color Names ==

Color names are `:`-delimited lists in string format (e.g.,
`intense_blue:italic`, referring to the color high-intensity, italicized blue).
Each `:`-delimited substring of each such string should be either:

* A key of map ${ZESHY_ANSI_SGR_NAME_TO_VALUE}.
* `grey`, a `zeshy`-specific pseudo-color _not_ a key of such map, guaranteed to
  be in greyscale, no darker than `black`, and no brighter than `white`. Since
  the ANSI standard specifies no such color, `zeshy` dynamically cobbles such
  color together from varying intensities of `black` and `white` supported by
  modern terminal emulators (e.g., `rxvt-unicode`).

Order is insignificant within such string (e.g., `white:bold` and `bold:white`
both refer to the same color). Ideally, such substrings should be unique within
such string, although this is not strictly necessary (e.g., while `white:bold`
and `white:bold:white` both refer to the same color, the latter is unseemly).

See ${ZESHY_ANSI_SGR_NAME_TO_VALUE} for further details.

== Internal Conversion ==

This map is intended for configuration purposes only. `zeshy` runnables should
(typically) instead expand ${ZESHY_STYLE_TO_COLOR}, a general-purpose map from
non-prompt style to color value initialized from this map during recompilation
of `zeshy`\'s user digest file.

Specifically, for each key-value pair of this map, `zeshy` defines the same key
of ${ZESHY_STYLE_TO_COLOR} to expand to the corresponding ANSI escape code. For
example, if this map has a key `print_call.line` with value `grey`, `zeshy` adds
to ${ZESHY_STYLE_TO_COLOR} key `print_call.line` with value `\E\[0;30m` (i.e.,
the ANSI escape code resetting the current foreground color to grey).
/---
() {
    # Colors commonly referenced below. Since zsh does *NOT* permit unquoted
    # colons in such text, quote such colors.
    string\
        runnable_function_prefix='blue'\
        runnable_function='blue:bold'\
        runnable_function_suffix='blue'\
        runnable_eval_prefix='cyan'\
        runnable_eval='cyan:bold'
        runnable_eval_suffix='cyan'\
        runnable_filename_prefix='magenta'\
        runnable_filename='magenta:bold'\
        runnable_filename_suffix='magenta'\
        query_prompt_border_left='blue:bold'\
        query_prompt_joiner_left='grey'\
        query_prompt_parens_left='red:bold'\
        query_prompt_parens_right='red:bold'\
        query_prompt_choice_default='cyan:bold'\
        query_prompt_choice_nondefault='cyan:italic'\
        query_prompt_choice_separator='grey'\
        query_prompt_choice_fork='grey'\
        query_prompt_input='white:bold'

    ZESHY_STYLE_TO_COLOR_NAMES=(
        # Pseudo-styles mapped to the corresponding colors. Referencing such
        # pseudo-styles elsewhere is discouraged if occasionally unavoidable.
        color.reset          reset
        color.default        default
        color.black          black
        color.red            red
        color.green          green
        color.yellow         yellow
        color.blue           blue
        color.magenta        magenta
        color.cyan           cyan
        color.white          white
        color.black:bold     black:bold
        color.red:bold       red:bold
        color.green:bold     green:bold
        color.yellow:bold    yellow:bold
        color.blue:bold      blue:bold
        color.magenta:bold   magenta:bold
        color.cyan:bold      cyan:bold
        color.white:bold     white:bold

        # output_call_stack().
        output_call_stack.corner_left_first      red:bold
        output_call_stack.border_left_first      red
        output_call_stack.joiner_left_first      red
        output_call_stack.corner_left_tween      red:bold
        output_call_stack.border_left_tween      red
        output_call_stack.joiner_left_tween      red
        output_call_stack.corner_left_last       red:bold
        output_call_stack.border_left_last       red
        output_call_stack.joiner_left_last       red
        output_call_stack.callee_function_prefix "${runnable_function_prefix}"
        output_call_stack.callee_function        "${runnable_function}"
        output_call_stack.callee_function_suffix "${runnable_function_suffix}"
        output_call_stack.callee_eval_prefix     "${runnable_eval_prefix}"
        output_call_stack.callee_eval            "${runnable_eval}"
        output_call_stack.callee_eval_suffix     "${runnable_eval_suffix}"
        output_call_stack.callee_filename_prefix "${runnable_filename_prefix}"
        output_call_stack.callee_filename        "${runnable_filename}"
        output_call_stack.callee_filename_suffix "${runnable_filename_suffix}"
        output_call_stack.caller_parens_left     white:bold
        output_call_stack.caller_parens_right    white:bold
        output_call_stack.caller_filename_prefix grey
        output_call_stack.caller_filename        grey:bold
        output_call_stack.caller_filename_suffix grey
        output_call_stack.caller_line_prefix     red
        output_call_stack.caller_line            red:bold
        output_call_stack.caller_line_suffix     red
#        output_call_stack.frame_prefix    red:bold
#        output_call_stack.function_name   blue:bold
#        output_call_stack.function_parens blue
#        output_call_stack.script_name     magenta:bold
#        output_call_stack.script_quotes   magenta
#        output_call_stack.eval_name       cyan:bold
#        output_call_stack.eval_parens     cyan
#        output_call_stack.brace           white:bold
#        output_call_stack.filename        grey:bold
#        output_call_stack.colon           grey
#        output_call_stack.line            red

        # output_line_horizontal().
        output_line_horizontal.border blue

        # print_aliases_cli().
        print_aliases_cli.type_abbreviation blue
        print_aliases_cli.type_substitution blue:bold
        print_aliases_cli.type_untyped      magenta
        print_aliases_cli.name              white:bold
        print_aliases_cli.equals            grey
        print_aliases_cli.quotes            grey:bold
        print_aliases_cli.expansion         cyan:italic

        # print_message().
        print_message.heading.text         blue:bold
        print_message.heading.corner_left  blue:bold
        print_message.heading.corner_right blue:bold
        print_message.heading.border_left  grey
        print_message.heading.border_right grey
        print_message.heading.joiner_left  grey
        print_message.heading.joiner_right grey
        print_message.content.text         white:bold
        print_message.content.border_left  grey
        print_message.content.border_right grey
        print_message.footing.corner_left  blue:bold
        print_message.footing.corner_right blue:bold
        print_message.footing.border_left  grey
        print_message.footing.border_right grey

        # print_warning().
        print_warning.heading.text         yellow:bold
        print_warning.heading.corner_left  yellow:bold
        print_warning.heading.corner_right yellow:bold
        print_warning.heading.border_left  grey
        print_warning.heading.border_right grey
        print_warning.heading.joiner_left  grey
        print_warning.heading.joiner_right grey
        print_warning.content.text         white:bold
        print_warning.content.border_left  grey
        print_warning.content.border_right grey
        print_warning.footing.corner_left  yellow:bold
        print_warning.footing.corner_right yellow:bold
        print_warning.footing.border_left  grey
        print_warning.footing.border_right grey

        # print_error().
#        print_error.heading.text         red:bold
#        print_error.heading.corner_left  red:bold
#        print_error.heading.corner_right red:bold
#        print_error.heading.border_left  grey
#        print_error.heading.border_right grey
#        print_error.heading.joiner_left  grey
#        print_error.heading.joiner_right grey
#        print_error.content.text            white:bold
#        print_error.content.border_left     grey
#        print_error.content.border_right    grey
#        print_error.footing.corner_left  red:bold
#        print_error.footing.corner_right red:bold
#        print_error.footing.border_left  grey
#        print_error.footing.border_right grey

        # print_exception().
        print_exception.heading.corner_left              red:bold
        print_exception.heading.corner_right             red:bold
        print_exception.heading.border_left              grey
        print_exception.heading.border_right             grey
        print_exception.heading.joiner_left              grey:bold
        print_exception.heading.joiner_right             grey:bold
        print_exception.heading.text                     red:bold
        print_exception.heading.runnable.eval_prefix     red
        print_exception.heading.runnable.eval_suffix     red
        print_exception.heading.runnable.function_prefix red
        print_exception.heading.runnable.function_suffix red
        print_exception.heading.runnable.filename_prefix red
        print_exception.heading.runnable.filename_suffix red
        print_exception.content.border_left              grey
        print_exception.content.border_right             grey
        print_exception.content.text                     white:bold
        print_exception.content.runnable.function_prefix "${runnable_function_prefix}"
        print_exception.content.runnable.function        "${runnable_function}"
        print_exception.content.runnable.function_suffix "${runnable_function_suffix}"
        print_exception.content.runnable.eval_prefix     "${runnable_eval_prefix}"
        print_exception.content.runnable.eval            "${runnable_eval}"
        print_exception.content.runnable.eval_suffix     "${runnable_eval_suffix}"
        print_exception.content.runnable.filename_prefix "${runnable_filename_prefix}"
        print_exception.content.runnable.filename        "${runnable_filename}"
        print_exception.content.runnable.filename_suffix "${runnable_filename_suffix}"
        print_exception.footing.corner_left              red:bold
        print_exception.footing.corner_right             red:bold
        print_exception.footing.border_left              grey
        print_exception.footing.border_right             grey

        # print_message_heading().
        print_message_heading.text         blue:bold
        print_message_heading.corner_left  blue:bold
        print_message_heading.corner_right blue:bold
        print_message_heading.border_left  grey
        print_message_heading.border_right grey
        print_message_heading.joiner_left  grey
        print_message_heading.joiner_right grey

        # print_message_item().
        print_message_item.text                   white:bold
        print_message_item.border_left            blue:bold
        print_message_item.border_right           blue:bold
        print_message_item.border_left_continued  blue
        print_message_item.border_right_continued blue
        print_message_item.joiner_right           grey
        print_message_item.padder_right           grey

        # print_usage().
        print_usage.usage                 grey:bold
        print_usage.usage_colon           grey:bold
        print_usage.command_name          cyan:bold
        print_usage.arg_brace             cyan
        print_usage.arg_name              cyan:bold
        print_usage.arg_ellipsis          grey:bold
        print_usage.synopsis              white:bold:italic
        print_usage.synopsis_command_name cyan:bold:italic
        print_usage.synopsis_arg_name     cyan:bold:italic
        print_usage.options_heading_name  magenta:bold
        print_usage.options_heading_colon grey:bold
        print_usage.option_dash           blue
        print_usage.option_name           blue:bold
        print_usage.option_equals         green
        print_usage.option_arg            green:bold
        print_usage.option_comma          grey:bold
        print_usage.option_synopsis       white:italic

        # set_string_to_query_character().
        set_string_to_query_character.prompt.border_left       "${query_prompt_border_left}"
        set_string_to_query_character.prompt.joiner_left       "${query_prompt_joiner_left}"
        set_string_to_query_character.prompt.parens_left       "${query_prompt_parens_left}"
        set_string_to_query_character.prompt.parens_right      "${query_prompt_parens_right}"
        set_string_to_query_character.prompt.choice_default    "${query_prompt_choice_default}"
        set_string_to_query_character.prompt.choice_nondefault "${query_prompt_choice_nondefault}"
        set_string_to_query_character.prompt.choice_separator  "${query_prompt_choice_separator}"
        set_string_to_query_character.prompt.choice_fork       "${query_prompt_choice_fork}"
        set_string_to_query_character.prompt.input             "${query_prompt_input}"

        # set_string_to_query_line().
        set_string_to_query_line.prompt.border_left       "${query_prompt_border_left}"
        set_string_to_query_line.prompt.joiner_left       "${query_prompt_joiner_left}"
        set_string_to_query_line.prompt.parens_left       "${query_prompt_parens_left}"
        set_string_to_query_line.prompt.parens_right      "${query_prompt_parens_right}"
        set_string_to_query_line.prompt.choice_default    "${query_prompt_choice_default}"
        set_string_to_query_line.prompt.choice_nondefault "${query_prompt_choice_nondefault}"
        set_string_to_query_line.prompt.choice_separator  "${query_prompt_choice_separator}"
        set_string_to_query_line.prompt.choice_fork       "${query_prompt_choice_fork}"
        set_string_to_query_line.prompt.input             "${query_prompt_input}"
    )
}

declare_global_with_stdin <<'/---'
map ZESHY_STYLE_TO_COLOR_NAMES_PROMPT

Map prompt style to color names, permitting human-readable customization of
colors output by `zeshy` runnables relating to the prompt. See
${ZESHY_STYLE_TO_COLOR_NAMES} for further details.

== Motivation ==

Prompt and non-prompt color values differ. While prompt colors must be delimited
by `%{` and `%}` to prevent such colors from erroneously contributing to the
prompt length, non-prompt colors require no such delimitation. Hence, mapping
style to color names requires separating such styles into prompt and non-prompt
styles and then maps from style to color names on the same basis.
/---
ZESHY_STYLE_TO_COLOR_NAMES_PROMPT=(
    # startup_zeshy_terminal_prompt() when the current user is root.
    startup_zeshy_terminal_prompt.superuser.brace                   grey
    startup_zeshy_terminal_prompt.superuser.host                    red
    startup_zeshy_terminal_prompt.superuser.user                    red:bold
    startup_zeshy_terminal_prompt.superuser.path                    grey:bold
    startup_zeshy_terminal_prompt.superuser.prior_command_succeeded grey:bold
    startup_zeshy_terminal_prompt.superuser.prior_command_failed    magenta:bold
    startup_zeshy_terminal_prompt.superuser.input                   white:bold

    # startup_zeshy_terminal_prompt() when the current user is not root.
    startup_zeshy_terminal_prompt.nonsuperuser.brace                   white:bold
    startup_zeshy_terminal_prompt.nonsuperuser.host                    cyan
    startup_zeshy_terminal_prompt.nonsuperuser.user                    cyan:bold
    startup_zeshy_terminal_prompt.nonsuperuser.path                    green
    startup_zeshy_terminal_prompt.nonsuperuser.prior_command_succeeded green
    startup_zeshy_terminal_prompt.nonsuperuser.prior_command_failed    red:bold
    startup_zeshy_terminal_prompt.nonsuperuser.input                   white:bold
)
