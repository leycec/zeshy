#!/usr/bin/env zsh
# ====================[ search                             ]====================
#                     [ Time-stamp: "2009-04-18 19:29:36 leycec" ]
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy Search, performing recursive pattern matching on file names and content.

# ....................{ CONFIGURATION                      }....................
# Case-sensitive grep options, respected only by grep aliases below.
#
# Do not define "GREP_OPTION"! When defined, all invocations of grep use these
# options. However, most such invocations do not expect grep to emit line
# numbers, colors, or other colorful noise. They expect grep -- plain grep, no
# ornamentation. (Let us avoid breaking the entire system, shall we?)
global_list ZESHY_GREP_OPTIONS; ZESHY_GREP_OPTIONS=(
    -1
    --color=always
    --exclude-dir='.cvs'
    --exclude-dir='.git'
    --exclude-dir='.svn'
    --extended-regexp
    --line-number
    --no-messages
    --with-filename
)

# Case-insensitive grep options, respected only by grep aliases below.
global_list ZESHY_GREP_INSENSITIVELY_OPTIONS; ZESHY_GREP_INSENSITIVELY_OPTIONS=(
    "${ZESHY_GREP_OPTIONS[@]}"
    --ignore-case
)

# ....................{ ALIASES                            }....................
alias gr="grep ${ZESHY_GREP_OPTIONS}"
alias gri="grep ${ZESHY_GREP_INSENSITIVELY_OPTIONS}"
alias grr="grep_recursively"
alias grri="grep_recursively_insensitively"

# ....................{ GREP                               }....................
# char *grep_recursively(char *pattern, char *path)
#
# Recursively match all file contents under the passed path against the passed
# POSIX-style regular expression. If no path is passed, this recursively matches
# under the current path. Thusly, the simplest usage of this shell script is:
#
#   # Find all text files whose contents match "Wisdom ~ \d\d ~ Outlays".
#   >>> grep-recursively 'Wisdom ~ \d\d ~ Outlays'
grep_recursively() {
    die_unless_at_least_one_argument 'expected at least a regular expression'
    string grep_pattern="${1}"; shift

    utter "grepping..."
    zpage grep --recursive ${=ZESHY_GREP_OPTIONS}\
        "${grep_pattern}" "${@:-${PWD}}"
}

# char *grep_recursively_insensitively(char *pattern, char *path)
#
# Recursively match all file contents under the passed path against the passed
# POSIX-style regular expression, case-insensitively.
grep_recursively_insensitively() {
    die_unless_at_least_one_argument 'expected at least a regular expression'
    string grep_pattern="${1}"; shift

    utter 'grepping case-insensitively...'
    zpage grep --recursive ${=ZESHY_GREP_INSENSITIVELY_OPTIONS}\
        "${grep_pattern}" "${@:-${PWD}}"
}

#FIXME: Obsolete.
# This
#   includes the standard retinue of *NIX commands, like "awk", "grep", "sed", 
#   and so forth.
        #as a directory, ignoring non-text files, dotfiles, and \"test\" subdirectories..."
#FIXME: Bizarre. "grep --include" does absolutely nothing. O_o
#alias grg="grep_glob"
#alias grgi="grep_glob_insensitively"
#
## char *grep_glob(char *grep_pattern, char *glob_expression)
##
## Grep all files matching the passed glob expression (e.g., "*.txt") against the
## passed grep pattern (e.g., "^unity in faith$").
#grep_glob() {
#    [[ ${#} -eq 1 || ${#} -eq 2 ]] ||
#        die "expected at least one regular expression"
#
#    local grep_pattern="${1}"
#    local glob_pattern="${2:-*.txt}"
#
#    utter "grepping \"${glob_pattern}\"..."
#    grep --include "${glob_pattern}" ${=ZESHY_GREP_OPTIONS}\
#        "${grep_pattern}" | "${PAGER}"
#}
#
## char *grep_glob_insensitively(char *grep_pattern, char *glob_expression)
##
## Grep all files matching the passed glob expression (e.g., "*.txt") against the
## passed grep pattern (e.g., "^unity in faith$") insensitively.
#grep_glob_insensitively() {
#    [[ ${#} -eq 1 || ${#} -eq 2 ]] ||
#        die "expected at least one regular expression"
#
#    local grep_pattern="${1}"
#    local glob_pattern="${2:-*.txt}"
#
#    utter "grepping \"${glob_pattern}\" case-insensitively..."
#    grep --include="${glob_pattern}" ${=ZESHY_GREP_INSENSITIVELY_OPTIONS}\
#        "${grep_pattern}"
#}

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyright 2007-2012 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
