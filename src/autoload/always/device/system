#!/usr/bin/env zsh
# ====================[ system                             ]====================
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy System, handling system stability.

# ....................{ TESTERS                            }....................
# void test_system(void)
#
# Torture test system stability.
test_system() {
    # Validate sanity.
    die_if_args
    die_unless_interactive

    #FIXME: Add support for the Phoronix test suite, available in ~arch. See:
    #  http://www.phoronix-test-suite.com
    # Find "mprime", if not installed in the $PATH (as under Gentoo).
    string test_command
    if   is_installed 'mprime'
    then test_command='mprime'
    elif is_installed '/opt/gimps/mprime'
    then test_command='/opt/gimps/mprime'
    fi
    die_unless_nonempty "${test_command}" '"mprime" not found in $PATH'

    #FIXME: Spawn "monitor_sensors" ourselves? Also, note that "conky" is
    #probably preferable for users having installed that.
    # Notify the user of impending heat death.
    utter 'consider monitoring CPU MCE errors with "mcelog" in another shell'
    utter 'consider monitoring temperature with "monitor_sensors" in another shell'
    utter 'if "monitor_sensors" shows an unexpected "ALARM", immediately kill this process'
    ask_any_key

    # Torture.
    "${test_command}" -t -w"$(get_temporary_home)"
}

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#
# Copyright 2007-2012 by Cecil Curry.
#
#   http://www.raiazome.com
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
