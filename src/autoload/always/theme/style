#!/usr/bin/env zsh
# ====================[ gwydden/style                      ]====================
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy Gwydden Style, theming Zsh styles (e.g., completions).
#
# --------------------( TODO                               )--------------------
# * Much of this file can be reasonably abstracted out for general use cross-
#   theme.
# * Complex but sweet auto-complete styles (complete with animated GIF intro!):
#    https://github.com/hchbaw/auto-fu.zsh/

# ....................{ SETUP                              }....................
setup_theme_styles() {
    die_if_args
    setup_theme_styles_completions
}

# To install and configure completions by menu, rather than hand, run:
#    compinstall
setup_theme_styles_completions() {
    die_if_args
    make_dir_safely "${ZESHY_COMPLETION_DIR}"

    zstyle ':completion:*' completer _oldlist _complete _match _approximate _prefix
    zstyle ':completion:*' expand suffix
    zstyle ':completion:*' format '[completing %d}'
    zstyle ':completion:*' ignore-parents parent pwd
    zstyle ':completion:*' insert-unambiguous true
    zstyle ':completion:*' list-colors ''
    zstyle ':completion:*' list-prompt %SAt %p: Hit tab for more, or the character to insert%s
    zstyle ':completion:*' match-original both
    zstyle ':completion:*' max-errors 1
    zstyle ':completion:*' menu select=long-list select=0
    zstyle ':completion:*' prompt '[corrected %e}'
    zstyle ':completion:*' select-prompt %SScrolling active: current selection at %p%s
    zstyle ':completion:*' verbose true

    # Match case-insensitively.
    zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z}' 'r:|[._-]=** r:|=**'

    # Use an active menu, rather than passive list, for tab completions.
    zstyle ':completion:*' menu select=2

    # Colorize tab completions.
    zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
    #zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
    #zstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#)*=0=01;31'

    #FIXME: Contemplate enabling, if Zsh begins failing to rehash the command hash
    #often enough.
    # Recache the command hash of all $PATH-accessible executables on every
    # command line, obviating the need for "hash -rf" when installing new
    # commands.
#   zstyle ":completion:*:commands" rehash 1

    # Cache tab completions, so as to improve tab completion responsivity.
    zstyle ':completion::complete:*' use-cache on
    zstyle ':completion::complete:*' cache-path "${ZESHY_COMPLETION_DIR}"

    # Ignore completion functions for commands we don't have.
    zstyle ':completion:*:functions' ignored-patterns '_*'

    # When tab completing pathnames, strip the trailing slash. (Nice for "ln".)
    zstyle ':completion:*' squeeze-slashes true

    # Improve "killall" completion.
    zstyle ':completion:*:killall:*' command 'ps -u $USER -o cmd'

    # When tab completing for "cd", ignore the current and parent paths.
    # zstyle ':completion:*:cd:*' ignore-parents parent pwd

    # Initialize completions after defining all completions above. It is especially
    # important this be done after defining the cache path, otherwise logging in as
    # root ejaculates the following interactive error:
    # 
    #     zsh compinit: insecure directories, run compaudit for list.
    #     Ignore insecure directories and continue [y] or abort compinit [n]?
    compinit -i -d "${ZESHY_COMPINIT_FILE}"
}

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyright 2007-2012 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
