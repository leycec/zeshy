#!/usr/bin/env zsh
# ====================[ mysql                              ]====================
#                     [ Time-stamp: "2009-04-18 19:29:36 leycec" ]
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy MySQL.

# ....................{ ALIASES                            }....................
interactive_alias mysql=mysql_shell

# ....................{ MYSQL SHELL                        }....................
# void mysql(string username = 'root', string password, ...)
#
# Run the interactive MySQL shell with sane option defaults under the passed
# username and password. Username defaults to "root", if not passed.
mysql_shell() {
    string username password
    if is_declared '2'; then
        username="${1}"; shift
        password="${2}"; shift
    elif is_declared '1'
    then username="${1}"; shift
    else username=root
    fi

    # Yes, the absence of a space after "-p" is intentional. Thanks, MySQL!
    utter "logging in as \"${username}\"..."
    mysql "${ZESHY_MYSQL_OPTIONS[@]}" -u "${username}" -p"${password}" "${@}"
}

#FIXME: Trivially silly as defined. Improve in accordance with Zeshy apache2.
# ....................{ PRINTERS                           }....................
# void mysql_info()
#
# Print MySQL-specific metadata, including:
#
# * Version.
print_mysql_info() {
    die_if_args
    mysql -V
}

#FIXME: Unsafe. Passwords should only be accepted as stdin -- not cached in the
#Zsh history as recallable commands.
# ....................{ SETTERS                            }....................
# void mysql_set_password(string username = 'root', string password)
#
# Set the passed password for the passed MySQL username. Username defaults to
# "root", if not passed. Note that new users are best created via interactive
# "CREATE USER" SQL commands entered as the root user: e.g.,
#
#     # Enter the interactive MySQL shell.
#     mysql
#
#     # Create a new user and password.
#     CREATE USER 'new_username'@'localhost' IDENTIFIED BY 'password_for_new_username';
#
#     # Assign privileges to this user.
#     GRANT ALL ON *.* TO 'new_username'@'localhost';
#
#     # And... we're done.
#     exit
mysql_set_password() {
    die_unless_one_or_two_args 'expected at least a password'

    string username password
    if is_declared '2'; then
        username="${1}"
        password="${2}"
    else
        username="root"
        password="${1}"
    fi

    utter "setting \"${username}\" password..."
    try mysqladmin -u "${username}" password "${password}"
}

# ....................{ MUTATORS                           }....................
# void mysql_make_database(string database_name,
#     string username = 'root',  string password = null)
#
# Make a new database using the passed MySQL username. The username defaults to
# the "root" user and the password defaults to nothing, in which case MySQL
# interactively queries you for that user's password.
mysql_make_database() {
    die_unless_at_least_one_arg 'expected at least one database name'
    string database_name="${1}" username="${2:-root}" password="${3}"
    utter "creating database \"${database_name}\" as user \"${username}\"..."
    mysqladmin -u "${username}" -p create "${database_name}"
}

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyright 2007-2012 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
