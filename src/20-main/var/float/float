#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

:parcel <<'-/-'
Handle *float variables* (i.e., variables whose values ore floating point
numbers approximating real numbers).
-/-

# ....................{ EXCEPTIONS                         }....................
declare_function_with_stdin <<'/---'
void die_unless_float(
    string value,
    string error_message = "\${value}\" not a float.")

Throw an exception with the passed message unless the passed string is a float.
See is_float() for further details.
/---
function die_unless_float() {
    die_unless_args_1_to_2\
        'Expected one string and optional error message.'
    string text="${1}"
    is_float "${text}" or die "${2:-\"${text}\" not a float.}"
}

# ....................{ TESTERS                            }....................
declare_function_with_stdin <<'/---'
[status: boolean] is_float(string value)

Return success if the passed string is a float (i.e., a string consisting of
optional negative sign, one or more digits, a decimal point, and optional
digits).
/---
function is_float() {
    # See :is_int() for further details.
    die_unless_arg 'Expected one string.'
    is "${1}" == (|-)<->.(|<->) si
}

# ....................{ ROUNDERS                           }....................
declare_function_with_stdin <<'/---'
float round_float(float number, integer precision = 0)

Round the passed float to the passed number of decimal places (defaulting to 0
and hence rounding to a whole integer).
/---
function round_float() {
    # Validate passed arguments.
    die_unless_args_1_to_2 'Expected one float and optional precision.'
    string number="${1}" precision="${2:-0}"
    die_unless_float "${number}"
    :die_unless_int_nonnegative "${precision}"

    # Round such float. By design, printf() rounds rather than truncates.
    printf "%.${precision}f\n" ${number}
}

# --------------------( WASTELANDS                         )--------------------
#FUXME: Also implement genuine die_unless_float() and is_float() methods.
#(Pilfer the implementation from the "integer" component.)
