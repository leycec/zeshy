#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

:parcel <<'/---'
Handle *string boxing* (i.e., embedding strings into visual boxes, typically
printed with familiar box-drawing characters).
/---

# ....................{ GETTERS                            }....................
declare_function_with_stdin <<'/---'
integer get_string_titled_content_width_in_style(string style_prefix)

Get the maximum number of characters in the content of each line of output (i.e.,
excluding width of visual borders on such lines) wrapped to the current terminal
under the user-configurable styles prefixed by the passed prefix. See
get_string_wrapped_width_in_style() for further details.
/---
function get_string_titled_content_width_in_style() {
    die_unless_arg 'Expected one style prefix.'
    get_string_wrapped_width_in_style "${1}content."
}

# ....................{ OUTPUTTERS                         }....................
declare_function_with_stdin <<'/---'
string :output_string_titled_in_style_caller(string text, string title)

Title the passed text, using user-configurable styles prefixed by the dot-
suffixed caller's name (i.e., `$(get_caller).`). See
:output_string_titled_in_style() for further details.
/---
function :output_string_titled_in_style_caller() {
    # Validate sanity.
    die_unless_args_2 'Expected one string and one title.'
    :string caller

    # Caller name.
    :set_string_to_caller caller

    # Title such string.
    :output_string_titled_in_style "${@}" "${caller}."
    # :print_stdout_separated_stop
}

declare_function_with_stdin <<'/---'
string :output_string_titled_in_style(
    string text,
    string title,
    string style_prefix)

Print the passed text with the passed title, using user-configurable styles
prefixed by the passed prefix. Specifically, print a ``box'' consisting of:

* Such title as a line horizontally centered in the current terminal, using
  user-configurable styles prefixed by `${style_prefix}heading.`.  See
  center_string_in_style() for further details.
* Such text as one or more lines horizontally wrapped to the current terminal,
  using user-configurable styles prefixed by `${style_prefix}content.`.  See
  wrap_string_in_style() for further details.
* The bottom edge of such box, using user-configurable styles prefixed by
  `${style_prefix}footing.`. Again, see
  center_string_in_style() for further details.
/---
function :output_string_titled_in_style() {
    # Validate sanity.
    die_unless_args_3 'Expected one string, one title, and one style prefix.'
    string text="${1}" title="${2}" style_prefix="${3}"

    # Print such title, content. and the bottom edge of the implied box.
    center_string_in_style\
        "${title}" "${style_prefix}heading."
    wrap_string_in_style\
        "${text}"  "${style_prefix}content."
    output_line_in_style\
                   "${style_prefix}footing."
}

# ....................{ PRINTERS                           }....................
declare_function_with_stdin <<'/---'
string print_string_titled_in_style_caller(string text, string title)

Title the passed text, using user-configurable styles prefixed by the
dot-suffixed caller's name (i.e., `$(get_caller).`). See
:output_string_titled_in_style() for further details.
/---
function print_string_titled_in_style_caller() {
    # Validate sanity.
    die_unless_args_2 'Expected one string and one title.'
    :string caller

    # Caller name.
    :set_string_to_caller caller

    # Prepare standard output for printing.
    :print_stdout_separated_start

    # Title such string.
    :output_string_titled_in_style "${@}" "${caller}."

    # Prepare standard output for subsequent printing.
    :print_stdout_separated_stop
}

#FIXME: In lieu of unit tests...
#function boxy() {
#    :output_string_titled_in_style 'Parable of the Box'\
#        'The box is full of salmon, and a man sits atop the box. Long ago this man hired armed guards to keep anyone from eating his fish. The many people who sit next to the empty river starve to death. But they do not die of starvation. They die of a belief. Everyone believes that the man atop the box owns the fish. The soldiers believe it, and they will kill to protect the illusion. The others believe it enough that they are willing to starve. But the truth is that there is a box, there is an emptied river, there is a man sitting atop the box, there are guns, and there are starving people.'\
#        'print_message.'
#     :output_string_titled_in_style 'Parable of the Box (2)'\
#        'The box is full of salmon, and a man sits atop the box. Long ago this
#man hired armed guards to keep anyone from eating his fish. The many
#people who sit next to the empty river starve to death. But they do
#not die of starvation. They die of a belief. Everyone believes that
#the man atop the box owns the fish. The soldiers believe it, and they
#will kill to protect the illusion. The others believe it enough that
#they are willing to starve. But the truth is that there is a box,
#there is an emptied river, there is a man sitting atop the box, there
#are guns, and there are starving people.'\
#        'print_message.'
#}

# --------------------( WASTELANDS                         )--------------------
#FUXME: Refactor existing *_in_style() functions accordingly.

#Handle *output layouts* (i.e., spatial orientations strings output according to 
#specific to the current terminal).
#FUXME: Everything should now call this rather than
#:output_string_titled_in_style().
#Print the first passed string centered to the width of the current terminal
#followed by the second string wrapped to such width, both styled under the user-
#configurable styles prefixed by the passed prefix (defaulting to the dot-
#suffixed name of the caller).
    # Print the bottom edge of the box, assuming default styles.
#FUXME: Improve documentation, naturally.
#Handle *output layouts* (i.e., spatial orientations with which to output
#strings).

    #FUXME: What's the "best" way to output the bottom edge of the box? I'm
    #contemplating generalizing center_string_in_style() such
    #that, when called with the empty string, it simply 
