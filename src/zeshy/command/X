#!/usr/bin/env zsh
# ====================[ X                                  ]====================
#                     [ Time-stamp: "2009-04-18 19:29:36 leycec" ]
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy X. This Zeshy component handles X11 and all forks thereof:
#       X.org, we're winking at you.

# ....................{ FONTS                              }....................
# Aliases.
alias fc-cache-dir="cache_font_dir"
alias fc-catp="print_cached_fonts"

# void cache_font_dir(char *dirname = PWD)
#
# Permanently add all fonts in the passed directory to the system-wide X11 font
# cache. This addition makes these fonts accessible to all subsequent "X11-
# aware" applications. This directory defaults to the current working directory,
# if not passed.
cache_font_dir() {
    [[ "${#}" -le 1 ]] || die "expected exactly one font directory"

    # If non-empty, this function pushed the passed directory onto the stack and
    # must thus pop it from the stack prior to returning
    local is_pushing_directory

    # Font directory to be cached.
    local font_dir
    if [[ -n "${1}" ]]; then
        font_dir="${1}"
        is_pushing_directory=1
        pushd "${font_dir}"
    else
        font_dir="${PWD}"
    fi
    font_dir="$(canonicalize_path "${font_dir}")"

    utter "preparing \"${font_dir}\" for caching..."
    try mkfontscale
    try mkfontdir

    utter "caching \"${font_dir}\"..."
    try xset fp+ "${font_dir}"

    utter "updating X.org font list..."
    try xset fp rehash

    # "fc-cache" is a dynamic alternative to the above. Older systems have no
    # "fc-cache" installed, however. For safety, do both.
    if is_installed fc-cache; then
        utter "updating fontcache..."
        try_as_superuser fc-cache -v
    fi

    [[ -z "${is_pushing_directory}" ]] || popd
}

# char *print_cached_fonts(void)
#
# Print a verbose list of all currently cached fonts in the system-wide X11 font
# cache.
print_cached_fonts() {
    [[ "${#}" -le 1 ]] || die "expected exactly one font directory"
    page fc-cat -rv
}
 
# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyleft 2007-2011 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
