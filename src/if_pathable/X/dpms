#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'-/-'
Handle Display Power Management Signaling (DPMS) under X11.
-/-

# ....................{ PRINTERS                           }....................
#FIXME: Rename to print_x_dpms().
declare_function_with_stdin <<'/---'
string print_x_dpms(void)

Print a human-readable synopsis of current X11 DPMS settings.
/---
function print_x_dpms() {
    die_if_args
    get_xset_status_of_type 'Screen Saver'
    get_xset_status_of_type 'DPMS (Energy Star)'
}

# ....................{ SETTERS                            }....................
declare_function_with_stdin <<'/---'
void disable_x_dpms(void)

Disable DPMS and hence *screen blanking* (i.e., monitor shutdown on inactivity).
/---
function disable_x_dpms() {
    # Validate sanity.
    die_if_args

    # Disable DPMS.
    print_message_item_interactively\
        'Disabling X11 Display Power Management Signaling (DPMS)...'
    xset s off
    xset -dpms

    # Print DPMS settings to verify such change.
    interactively print_x_dpms
}

declare_function_with_stdin <<'/---'
void enable_x_dpms(void)

Enable DPMS and hence *screen blanking* (i.e., monitor shutdown on inactivity).
/---
function enable_x_dpms() {
    # Validate sanity.
    die_if_args

    # Enable DPMS.
    print_message_interactively\
        'enabling X11 Display Power Management Signaling (DPMS)...'
    xset s on
    xset +dpms

    # Print DPMS settings to verify such change.
    interactively print_x_dpms
}

# --------------------( WASTELANDS                         )--------------------
#   interactively print_message 'displaying X11 DPMS settings...'
#    _print_x_dpms
#}

#FUXME: This is pretty hideous.
#function _print_x_dpms() {
#    die_if_args

#This is particularly helpful while enjoying media but should be manually re-
#enabled when done.
#   string xset_output="$(xset -q)"
#   print "${xset_output}" | grep '^Screen Saver:$'       --after-context=2
#   print "${xset_output}" | grep '^DPMS (Energy Star):$' --after-context=2
