#!/usr/bin/env zsh
# ====================[ runnable                           ]====================
#
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2012 by Cecil Curry.
# See "COPYING" for additional details.
#
# --------------------( SYNOPSIS                           )--------------------
# Handle Zeshy-specific functions and aliases.

# ....................{ EXCEPTIONS                         }....................
# void die_unless_zeshy_runnable(
#   string runnable_name,
#   string error_message = "\"${runnable_name}\" not a Zeshy function or alias")
#
# Throw an exception unless the passed Zeshy-specific function or alias exists.
function die_unless_zeshy_runnable() {
    die_unless_args_1_to_2\
        'expected one runnable name and optional error message'
    string runnable_name="${1}"
    is_zeshy_runnable "${runnable_name}" or
        die "${2:-\"${runnable_name}\" not a Zeshy function or alias}"
}

# ....................{ TESTERS                            }....................
# boolean is_zeshy_runnable(string runnable_name)
#
# Return true if the passed Zeshy-specific runnable exists. Since Zeshy cannot
# define new zsh builtins or operators (despite the simulacra of global
# aliases), Zeshy-specific runnables are only those zsh aliases and functions
# defined by the Zeshy codebase.
function is_zeshy_runnable() {
    # Validate passed arguments.
    die_unless_one_arg 'expected one runnable name'
    string runnable_name="${1}"

    # If the passed alias or function does not exist, return false immediately.
    is_function_or_alias "${runnable_name}" or return_false

    #FIXME: Once we define maps from function and alias names to the Zeshy
    #components defining such names, switch this for an is_map_key()-style
    #implementation for *MUCH* better efficiency.

    # If the passed function exists, return true only if Zeshy defined such
    # function. Since Zeshy functions vastly outweigh Zeshy aliases, search for
    # the former first.
    if   is_function "${function_name}"
    then is_list_contains "${ZESHY_FUNCTION_NAMES}" | return_command_exit_status
    # If the passed alias exists, return true only if Zeshy defined such alias.
    else is_list_contains "${ZESHY_ALIAS_NAMES}" | return_command_exit_status
    fi
}

# --------------------( WASTELANDS                         )--------------------
