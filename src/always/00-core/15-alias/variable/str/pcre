#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'/---'
Handle core *PCRE* (i.e., Perl-Compatible Regular Expression) aliases.
/---

#FIXME: Don't neglect to ensure that our exception handler explicitly undefines
#alias "}~" if still defined.

# ....................{ ITERATORS                          }....................
#FIXME: Rename all runnables called below accordingly (e.g., prefix by ":")!

declare_alias_with_stdin\
    '[stdout: str, stderr: str] ":for_string_text_matching_pcre_start~{"(
        str text,
        str pcre,
        str code)'\
    ':alias_global "}~"="
        :undefine_alias \"}~\"
        :str\
            text__fstmps=\"${args__fstmps[1]}\"\
            pcre__fstmps=\"${args__fstmps[2]}\"\
            code__fstmps=\"${args__fstmps[3]}\"
        :die_unless_str_nonempty pcre__fstmps \"Expected non-empty PCRE.\"

        :str  MATCH
        :list match

        pcre_compile -- \"${pcre__fstmps}\"

        pcre_study

        string ZPCRE_OP=\"0 0\"
        while { pcre_match -b -n ${ZPCRE_OP[(w)2]} -- \"${text__fstmps}\" } {"

    :list args__fstmps
    :set_list_to_args_3_or_die args__fstmps\
        "Expected one string, one PCRE, and one command."' <<'/---'
Hello.
/---

# --------------------( WASTELANDS                         )--------------------
