#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'/---'
Handle *module-specific runners* (i.e., functions temporarily loading one or
more otherwise unsafe `zsh` modules while dynamically evaluating the passed
strings as commands).
/---

#FIXME: Add examples.

# ....................{ RUNNERS                            }....................
declare_function_with_stdin <<'/---'
[stdout: string, stderr: string, status: integer] run_code_with_mapfile:(
   string code1, ...)

Run the passed code with temporary access to map global ${mapfile} exported by
`zsh` module `mapfile`. While this function _is_ moderately safer than cruder
alternatives (e.g., zmodload(), load_module_mapfile()), the possibility of
permanent filesystem derangement remains -- rendering this function inherently
unsafe at best. See load_module_mapfile() for further details on the plausible
risks of such global and module.
/---
function run_code_with_mapfile:() {
    die_unless_args 'Expected one or more shell words.'
    load_module_mapfile
    try {
        run_code "${@}"
    } always :{
        unload_module_mapfile
    }:
}

# --------------------( WASTELANDS                         )--------------------
# a pall spectre.
# for the
#duration of such execution.
