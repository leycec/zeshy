#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'/---'
Handle standard output. See @{stdin} for further details.
/---

# ....................{ EXCEPTIONS                         }....................
declare_function_with_stdin <<'/---'
void die_unless_stdout_terminal(
    string error_message = "expected standard output printing to a terminal")

Throw an exception with the passed message unless standard output for this
function is a terminal. See is_stdout_terminal() for further details.
/---
function die_unless_stdout_terminal() {
    die_unless_args_0_to_1 'expected optional error message'
    is_stdout_terminal or
        die "${1:-expected standard output printing to a terminal}"
}

# ....................{ TESTERS                            }....................
declare_function_with_stdin <<'/---'
[status: boolean] is_stdout_pipe(void)

Return success if standard output for this function is a *pipe* (i.e., any
subcommand of a pipeline, excluding the first such subcommand).
/---
function is_stdout_pipe() {
    die_if_args
#   output_string "call stack: ${funcstack[*]}"
    is -p "${ZESHY_STDOUT_PATH-/dev/stdout}" si
}

declare_function_with_stdin <<'/---'
[status: boolean] is_stdout_terminal(void)

Return success if standard output for this function is a terminal.
/---
function is_stdout_terminal() {
    die_if_args
    is -t ${ZESHY_STDOUT_FILE_DESCRIPTOR-1} si
}

declare_function_with_stdin <<'/---'
[status: boolean] is_stdout_terminal_or_pipe(void)

Return success if standard output for this function is either a terminal or
pipe. While this function cannot test whether such pipe writes to a command
whose standard output is a terminal (e.g., to page_stdin()), this is the best
that `zsh` currently permits.
/---
function is_stdout_terminal_or_pipe() {
    die_if_args
    is -t ${ZESHY_STDOUT_FILE_DESCRIPTOR-1} si or is_stdout_pipe
}

# --------------------( WASTELANDS                         )--------------------
#-p "${ZESHY_STDOUT_PATH-/dev/stdin}" si
