#!/usr/bin/env zsh
# ====================[ partition                          ]====================
#
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.
#
# --------------------( SYNOPSIS                           )--------------------
# Handle disk partitions.

# ....................{ PRINTERS                           }....................
document_function '
string print_partitions(string device_filename1, string device_filename2, ...)

Print the partition table for each passed device or all available disk devices
listed by "/proc/partitions" if no such devices are passed.
'
function print_partitions() {
    die_unless_pathable fdisk
    fdisk -l "${@}"
}

# ....................{ WRITERS                            }....................
document_function '
void copy_device_partition_table_to_device(
  string source_device_file, string target_device_file)

Destructively copy the partition table from the first to second passed disk.
This deletes the partition table of the latter, rendering data on such disk
inaccessible and hence effectively deleted.
'
function copy_device_partition_table_to_device() {
    # Validate passed arguments.
    die_unless_pathable sfdisk\
        '"sfdisk" required for partition table cloning but not installed'
    die_unless_args_2\
        'expected exactly one source and one target device file'
    string device_file_source="${1}" device_file_target="${2}"
    die_unless_disk "${device_file_source}"
    die_unless_disk "${device_file_target}"
    die_unless_pathable sfdisk

    # If the current user interactively agrees, copy such table.
    is_response_yes_strongly_for_question\
        "really copy partition table from \"${device_file_source}\" to \"${device_file_target}\"?"\
        and sfdisk -d "${device_file_source}" | sfdisk "${device_file_target}"
}

# --------------------( WASTELANDS                         )--------------------
