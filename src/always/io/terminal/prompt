#!/usr/bin/env zsh
# ====================[ prompty                            ]====================
#
# --------------------( SYNOPSIS                           )--------------------
# Zeshy Prompt, handling interactive shell prompts.
#
# --------------------( SEE ALSO                           )--------------------
# http://aperiodic.net/phil/prompt/
#   Phillip Gold's fairly phenomenal "ZSH Prompt" treatise.
#
# --------------------( TODO                               )--------------------
# * Incorporate the following other prompt scripts:
#  * Has a fantastic series of functions for setting the terminal title!
#    http://www.semicomplete.com/misc/rcfiles/zshrc

# ....................{ SPLASH                             }....................
# Display introductory "splash" text. This is a line or two of text displayed
# prior to displaying the shell prompt, on initial start-up of the shell.
#
# This text is defined and displayed according to ZSH shell prompt syntax.
# Thus, see "info zsh" for details.

# ....................{ HOOKS                              }....................
# void precmd()
#
# Modifies the current shell environment prior to printing the current prompt.
# Zsh runs this function immediately after the process for the previous command
# completes but immediately before printing another prompt for the next command.
#precmd() {
#}

# void preexec(string command_name, string command_arg_1, ...)
#
# Modifies the current shell environment prior to running the passed command.
# Zsh runs this function immediately after the current user inputs a command at
# the current prompt and then inputs <Enter>, but immediately before executing
# the command.
preexec() {
    # Force this command's print_string to be bold white, regardless of the previous
    # color print_string by this command's prompt.
    print -Pn -- "${FG_WHITE}"
}

# ....................{ SETTERS                            }....................
setup_theme_prompt() {
    die_if_args

    # Define user-specific colors to be used in prompts below.
    string command_color machine_color path_color command_failed_color
    if is_current_user_superuser; then
        command_color=${FG_GREY}
#       command_color=${FG_BLACK_BOLD}
        machine_color=${FG_RED}
        path_color=${FG_WHITE}
        command_failed_color=${FG_MAGENTA}
    else
        command_color=${FG_WHITE_BOLD}
        machine_color=${FG_CYAN}
        path_color=${FG_GREEN}
        command_failed_color=${FG_RED}
    fi

    #FIXME: This can be simplified by noting the only difference between the root
    #and non-root prompts are the colors and that, therefore, this difference may
    #be abstracted out by defining these colors in a pre-prompt Zsh function.
    # Define (and export) the ANSI shell prompt. To view this prompt as colorized
    # output, type "print -P $PS1"; and to view and edit this prompt as plaintext
    # source, type "vared PS1".
    #
    # This text is defined and displayed according to ZSH shell prompt syntax.
    # See "info zsh" for details.
    PS1=''
    PS1+="${command_color}[${machine_color}%m %B%n${command_color}}"   # user
    PS1+="${path_color}%~"                                             # path
    PS1+="%B%(1/?%(0??${path_color}/?${command_failed_color}!)?)"      # last process failed?
    PS1+="${command_color}"                                            # input
    export PS1
    #export PS1="%(!?${FG_BLACK_BOLD}[${FG_RED}%m %B%n${FG_BLACK_BOLD}}${FG_WHITE}%~%B%(1/?%(0??${FG_WHITE}/?${FG_RED}!)?)${FG_BLACK_BOLD}?${FG_WHITE_BOLD}[${FG_CYAN}%m %B%n${FG_WHITE_BOLD}}${FG_GREEN}%~%B%(1/?%(0??${FG_GREEN}/?${FG_RED}!)?)${FG_WHITE_BOLD})"

    # Undefine the right-hand prompt, if formerly defined.
    export RPROMPT=
#   print "PS1: ${PS1}"
}

#FIXME: Obsolete.
# * "${PS1}", the core shell prompt variable, in a root-aware manner.
# * Splash message, terse introductory text welcoming the current user to Zeshy.
# * Help message, verbose synopsizing Zeshy functionality, issues, and usage

# --------------------( COPYRIGHT AND LICENSE              )--------------------
# The information below applies to everything in this distribution,
# except where noted.
#              
# Copyright 2007-2012 by Cecil Curry.
#   
#   http://www.raiazome.com
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
