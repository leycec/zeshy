#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'/---'
Handle color-specific prompt escape codes.
/---

# ....................{ GLOBALS                            }....................
declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR

Map lowercase color name followed by optional attributes to the prompt-specific
ANSI escape code enabling such color at the shell prompt on the current
terminal. See ${ZESHY_COLOR} for further details.
/---

declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR_2

Map lowercase color name followed by optional attributes to the prompt-specific
ANSI escape code enabling such color at the shell prompt on monochrome terminals
(i.e., _not_ supporting the canonical eight colors). See ${ZESHY_COLOR} for
further details.
/---

declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR_8

Map lowercase color name followed by optional attributes to the prompt-specific
ANSI escape code enabling such color at the shell prompt on polychrome terminals
(i.e., supporting the canonical eight colors). See ${ZESHY_COLOR} for further
details and ${ZESHY_COLOR_NAMES_8} for a list of such colors.
/---

# ....................{ GLOBALS ~ style                    }....................
declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR_STYLE

Map lowercase color style name to the prompt-specific ANSI escape code enabling
such color on the current terminal. See
${ZESHY_PROMPT_STYLE_TO_COLOR_NAME} for default color style names.
/---

declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR_STYLE_2

Map lowercase color style name to the prompt-specific ANSI escape code enablingi
such color on monochrome terminals. See ${ZESHY_STYLE_TO_COLOR} and
${ZESHY_COLOR_2} for further details on the former and latter, respectively.
/---

declare_global_with_stdin <<'/---'
map ZESHY_PROMPT_COLOR_STYLE_8

Map lowercase color style name to the prompt-specific ANSI escape code enabling
such color on polychrome terminals. See ${ZESHY_STYLE_TO_COLOR} and
${ZESHY_COLOR_2} for further details on the former and latter, respectively.
/---

# ....................{ GLOBALS ~ glob                     }....................
declare_global '
string ZESHY_PROMPT_COLOR_GLOB

Glob matching color-specific zsh prompt escape codes.
'
# Dismantled, this is:
#
# * "%(...)", matching a "%"-prefixed prompt escape.
# * "[BbSsUu]", matching a bold, italic, or underline parameter.
# * "[0-9]##[FfKk]", matching a fore- or background parameter prefixed by
#   integer argument consisting of one or more digits.
# * "[FfKk]\{?*\}", matching a fore- or background parameter suffixed by:
#   * String argument consisting of a well-known color name (e.g., "red").
#   * Integer argument consisting of one or more digits.
ZESHY_PROMPT_COLOR_GLOB='%([BbSsUu]|[0-9]##[FfKk]|[FfKk]\{?*\})'

# ....................{ REMOVERS                           }....................
declare_function '
string remove_string_prompt_colors(string text1, string text2, ...)

Remove all zsh color codes from the passed string. The resulting string will
retain non-color prompt escapes (e.g., "%D", expanding to the current date).
'
function remove_string_prompt_colors() {
    die_unless_args 'expected at least one string'
    remove_string_glob_matches "${*}" "${ZESHY_PROMPT_COLOR_GLOB}"
}

# --------------------( WASTELANDS                         )--------------------
