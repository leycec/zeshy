#!/usr/bin/env zsh
# --------------------( LICENSE                            )--------------------
# Copyright 2007-2013 by Cecil Curry.
# See "COPYING" for additional details.

declare_parcel_as_script_with_stdin <<'/---'
Handle *string boxing* (i.e., embedding strings into visual boxes, typically
printed with familiar box-drawing characters).
/---

#FIXME: Refactor existing *_with_style_prefix() functions accordingly.

# ....................{ GETTERS                            }....................
declare_function_with_stdin <<'/---'
integer get_string_titled_content_width_with_style_prefix(string style_prefix)

Get the maximum number of characters in the content of each line of output (i.e.,
excluding width of visual borders on such lines) wrapped to the current terminal
under the user-configurable styles prefixed by the passed prefix. See
get_string_wrapped_width_with_style_prefix() for further details.
/---
function get_string_titled_content_width_with_style_prefix() {
    die_unless_arg 'Expected one style prefix.'
    get_string_wrapped_width_with_style_prefix "${1}content."
}

# ....................{ PRINTERS                           }....................
declare_function_with_stdin <<'/---'
string print_string_titled(string text, string title)

Print the passed text with the passed title, using user-configurable styles
prefixed by the dot-suffixed caller's name (i.e., `$(get_caller).`). See
print_string_titled_with_style_prefix() for further details.
/---
function print_string_titled() {
    die_unless_args_2 'Expected one string and one title.'
    print_string_titled_with_style_prefix "${@}" "$(get_caller)."
}

declare_function_with_stdin <<'/---'
string print_string_titled_with_style_prefix(
    string text, string title, string style_prefix)

Print the passed text with the passed title, using user-configurable styles
prefixed by the passed prefix. Specifically, print a ``box'' consisting of:

* Such title as a line horizontally centered in the current terminal, using
  user-configurable styles prefixed by `${style_prefix}heading.`.  See
  output_string_centered_with_style_prefix() for further details.
* Such text as one or more lines horizontally wrapped to the current terminal,
  using user-configurable styles prefixed by `${style_prefix}content.`.  See
  output_string_wrapped_with_style_prefix() for further details.
* The bottom edge of such box, using user-configurable styles prefixed by
  `${style_prefix}footing.`. Again, see
  output_string_centered_with_style_prefix() for further details.
/---
function print_string_titled_with_style_prefix() {
    # Validate sanity.
    die_unless_args_3 'Expected one string, one title, and one style prefix.'
    string text="${1}" title="${2}" style_prefix="${3}"

    # Prepare standard output for printing.
    start_stdout

    # Print such title, content. and the bottom edge of the implied box.
    output_string_centered_with_style_prefix\
        "${title}" "${style_prefix}heading."
    output_string_wrapped_with_style_prefix\
        "${text}"  "${style_prefix}content."
    output_string_centered_with_style_prefix\
        ''         "${style_prefix}footing."

    # Prepare standard output for subsequent printing.
    stop_stdout
}

#FIXME: In lieu of unit tests, this will do.
#function boxy() {
#    print_string_titled_with_style_prefix 'Parable of the Box'\
#        'The box is full of salmon, and a man sits atop the box. Long ago this man hired armed guards to keep anyone from eating his fish. The many people who sit next to the empty river starve to death. But they do not die of starvation. They die of a belief. Everyone believes that the man atop the box owns the fish. The soldiers believe it, and they will kill to protect the illusion. The others believe it enough that they are willing to starve. But the truth is that there is a box, there is an emptied river, there is a man sitting atop the box, there are guns, and there are starving people.'\
#        'print_message.'
#     print_string_titled_with_style_prefix 'Parable of the Box (2)'\
#        'The box is full of salmon, and a man sits atop the box. Long ago this
#man hired armed guards to keep anyone from eating his fish. The many
#people who sit next to the empty river starve to death. But they do
#not die of starvation. They die of a belief. Everyone believes that
#the man atop the box owns the fish. The soldiers believe it, and they
#will kill to protect the illusion. The others believe it enough that
#they are willing to starve. But the truth is that there is a box,
#there is an emptied river, there is a man sitting atop the box, there
#are guns, and there are starving people.'\
#        'print_message.'
#}

# --------------------( WASTELANDS                         )--------------------
#Handle *output layouts* (i.e., spatial orientations strings output according to 
#specific to the current terminal).
#FUXME: Everything should now call this rather than
#print_string_titled_with_style_prefix().
#Print the first passed string centered to the width of the current terminal
#followed by the second string wrapped to such width, both styled under the user-
#configurable styles prefixed by the passed prefix (defaulting to the dot-
#suffixed name of the caller).
    # Print the bottom edge of the box, assuming default styles.
#FUXME: Improve documentation, naturally.
#Handle *output layouts* (i.e., spatial orientations with which to output
#strings).

    #FUXME: What's the "best" way to output the bottom edge of the box? I'm
    #contemplating generalizing output_string_centered_with_style_prefix() such
    #that, when called with the empty string, it simply 
